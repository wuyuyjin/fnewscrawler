from fnewscrawler.mcp import mcp_server
from fnewscrawler.spiders.iwencai import get_secu_margin_trading_info


@mcp_server.tool(title="获取个股融资融券信息")
async def get_secu_margin_trading_info_tool(stock_code: str, data_num: int = 40):
    """
    获取指定股票近{data_num}个交易日的详细融资融券交易数据，最大可获取100条数据

    融资融券是重要的市场情绪和资金面指标，反映投资者对股票的看多看空情绪。
    此工具提供全面的融资融券数据分析，帮助判断市场参与者的投资行为和情绪变化。

    适用场景：
    - 分析投资者对个股的看多看空情绪变化趋势
    - 研究融资买入与股价走势的关联性
    - 评估融券做空力量对股价的潜在影响
    - 监控两融余额变化反映的市场热度
    - 结合股价走势判断融资融券的助涨助跌作用
    - 识别异常融资融券活动可能预示的行情转折

    参数说明：
    :param stock_code: 股票代码，支持格式：
        - 主板A股：000001（平安银行）、600036（招商银行）
        - 创业板：300750（宁德时代）、002415（海康威视）
        - 科创板：688981（中芯国际）、688599（天合光能）
        输入6位纯数字代码即可，无需交易所前缀
        注意：只有融资融券标的股票才有相关数据
    :param data_num: 返回数据条数，默认40条

    返回数据字段详解：
    - 序号：数据记录的序列号（1为最新交易日）
    - 交易时间：融资融券数据对应的交易日期
    - 融资余额：当日收盘后融资未偿还的总金额（亿元/万元）
    - 融资买入额：当日通过融资方式买入的股票金额（亿元/万元）
    - 融资偿还额：当日偿还融资本金的金额（亿元/万元）
    - 融资净买入：融资买入额减去融资偿还额的净值（万元）
        * 正值表示融资净买入，看多情绪强
        * 负值表示融资净卖出，看多情绪减弱
    - 融券余量：当日收盘后融券未偿还的股票数量（万股）
    - 融券卖出量：当日通过融券方式卖出的股票数量（万股）
    - 融券偿还量：当日偿还融券股票的数量（万股）
    - 融券净卖出：融券卖出量减去融券偿还量的净值（万股）
        * 正值表示融券净卖出增加，看空情绪强
        * 负值表示融券净买入，看空情绪减弱
    - 融资融券余额：融资余额与融券余额的合计（亿元）

    数据分析要点：
    1. 融资净买入持续为正：表明投资者看多情绪浓厚，可能推高股价
    2. 融券净卖出增加：显示看空力量增强，对股价形成压制
    3. 融资融券余额变化：反映整体市场参与度和关注度
    4. 融资买入额与股价涨跌的相关性：判断融资是否起到助涨作用
    5. 融券余量异常增加：可能预示重要股东减持或机构看空

    重要提示：
    - 数据按时间倒序排列，序号1为最新交易日
    - 融资融券具有杠杆效应，对股价波动有放大作用
    - 需结合股价走势、成交量等指标综合分析
    - 部分股票可能暂停融资融券交易，届时数据会显示异常

    :return: Markdown格式的融资融券数据表格，包含近{data_num}个交易日的完整两融交易信息
    """
    markdown_table = await get_secu_margin_trading_info(stock_code, data_num)
    return markdown_table